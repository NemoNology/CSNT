# Link aggregation - Агрегирование каналов

## Основная информация

### Что и зачем?

**Агрегирование каналов** - механизм объединения нескольких физических каналов в один логический.

Стандарт IEEE 802.3ad - "Link aggregation for parallel links";  
*Механизм работает на 2-ом уровне TCP\OSI?*

Данная технология применяется для:
- Резервирование каналов
- Увеличение общей пропускной способности
- Балансировка нагрузки на каналы

### Условия работы агрегирования

- Исходить и завершаться в одном и том же устройстве
- Одинаковая пропускная способность (100 Mb/s, 1 Gb/s и т.д.)
- Одинаковый способ передачи (Витая пара, оптоволокно)
- Одинаковый 802.1Q
  - Тип: Access, trunk
  - Настройки VLAN
- Одинаковый режим дуплекса (полный, полу)

### Типы агрегирования

|                       Качества \ Тип |       Статическое        |              Динамическое               |
| -----------------------------------: | :----------------------: | :-------------------------------------: |
|                         Конфигурация | Ручная на каждой стороне | Автоматическая за счёт LACP или *PAgP** |
|     Согласование конфигураций сторон |           Нет            |                   Да                    |
| Задержка при обновлении конфигурации |           Нет            |                   Да                    |

*\* - проприетарный Cisco протокол*

### Распределение и балансировка нагрузки

Для распределения пакетов используется алгоритм, получающий на вход данные пакетов (например MAC/IP-адрес получателя/отправителя) и отдающий номер физического канала (внутри логического), по которому пойдёт пакет.  
Из примеров подобного алгоритма: хеш-алгоритм и/или результат остатка от деления на количество портов в канале.

Балансировка достигается за счёт настроек вышеуказанного алгоритма. Для этого предполагается выбор типа алгоритма. Примеры:
- MAC-адрес получателя/отправителя;
- IP-адрес получателя/отправителя;
- *UDP/TCP порт получателя/отправителя*\*;
- MAC-адрес получателя и отправителя (XOR);
- IP-адрес получателя и отправителя (XOR);

*\* - поддерживается не всеми устройствами*

Если я выбрал mac-dst, то он работает в обе стороны? Не думаю...

#### Примеры

##### mac-dst

##### ip-src

##### ip-dst-src

### Настройка в консоли

## Дополнительная информация

### Используемые ресурсы

1. [Википедия](https://ru.wikipedia.org/wiki/Агрегирование_каналов) & [Wikipedia](https://en.wikipedia.org/wiki/Link_aggregation)
2. [Link Aggregation and Ethernet Bonding](https://www.alliedtelesis.com/sites/default/files/documents/configuration-guides/linkag_feature_overview_guide.pdf)
3. [Contribution to the November ‘98 Link Aggregation Meeting](https://grouper.ieee.org/groups/802/3/ad/public/nov98/jeffree_2_1198.pdf)
4. [Networks by Rebrain: Link Aggregation](https://www.youtube.com/watch?v=rfFPosdcye4)
5. [Протокол агрегирования каналов: Etherchannel](https://habr.com/ru/articles/334778/)